---
layout: post
title: После сборки доработать напильником
category: development, tools, automation
---

Прошлая попытка использовать phantomjs закончилась неудачей - он не умел разделять сессии, а значит его невозможно было использовать. Эта фича уже была готова к релизу, но зарелизить с ней стабильную версию у ребят [не получилось](http://ivandemarino.me/2014/01/phantomjs_196vs197/) =). Однако текущий master фантома вполне себе собирается и отлично работает. Для полноценного использования в гриде нам не хватало еще пары фич.

Первая, наверное не очень актуальная для большинства - возможность задавать прокси-класс на удалённом хабе (чтобы отслеживать состояние нод). Её заимплементил один очень скромный разработчик нашего фреймворка запуска тестов, пожелавший остаться неизвестным). Наши изменения уже [приняли в ghostdriver](https://github.com/detro/ghostdriver/pull/311), а [pull-request в phantomjs](https://github.com/ariya/phantomjs/pull/11980) всё еще открыт.

Вторая фича - возможность задавать прокси-сервер в запущенном браузере. Казалось бы критикал фича для браузера, но как-то до сих пор никому (почти) не была нужна. Однако в глубинах фантома был обнаружен [этот pull-request](https://github.com/ariya/phantomjs/pull/11829) трехмесячной давности - ребята добавили возможность выставлять прокси и успешно пользуются этим в связке с [casperjs](http://casperjs.org/). Но чтобы использовать это в наших тестах нужно было поддержать эту функциональность со стороны ghostdriver'а, [что я и сделал](https://github.com/detro/ghostdriver/pull/321).

<strike>Для ленивых</strike> Для тех, кто не хочет собирать рабочую версию по кусочкам из разных репозиториев, я также сделал [патч](https://gist.github.com/artkoshelev/9346848), который можно наложить на мастер фантома и собрать себе версию с этими двумя фичами. Коментим и лайкаем на гитхабе, чтобы наши реквесты как можно быстрее вмёржили и фичи появились в ближайшем стабильном релизе =).